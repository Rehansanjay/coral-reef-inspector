<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coral Reef Inspector</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-deep: #020617;
            --bg-surface: rgba(15, 23, 42, 0.6); 
            --primary: #38bdf8; /* Cyan */
            --accent: #f472b6;  /* Pink */
            --text-main: #f8fafc;
            --text-dim: #cbd5e1;
            --healthy: #4ade80;
            --bleached: #fb7185;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Outfit', sans-serif;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            color: var(--text-main);
        }

        /* --- HD BACKGROUND LAYER --- */
        .bg-image {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -3;
            background: url('https://images.unsplash.com/photo-1546026423-cc4642628d2b?q=80&w=1920&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            filter: brightness(1.1) saturate(1.3) contrast(1.1);
        }

        /* --- DARK OVERLAY --- */
        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(2, 6, 23, 0.3), rgba(15, 23, 42, 0.9)); z-index: -2;
        }

        /* --- PLANKTON EFFECT --- */
        .plankton-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none; background: transparent;
        }
        .speck {
            position: absolute; background: rgba(255, 255, 255, 0.4);
            border-radius: 50%; animation: float 20s infinite linear;
            box-shadow: 0 0 5px rgba(255,255,255,0.4);
        }
        @keyframes float {
            0% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { transform: translateY(-100vh) translateX(20px); opacity: 0; }
        }

        /* --- SIDEBAR MENU (UPGRADED) --- */
        .menu-btn {
            position: fixed; top: 30px; left: 30px;
            background: rgba(0, 0, 0, 0.6); border: 1px solid var(--primary); color: var(--primary);
            font-size: 1.5rem; padding: 10px 15px; border-radius: 8px; cursor: pointer; z-index: 1000;
            transition: 0.3s; backdrop-filter: blur(5px); box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        .menu-btn:hover { background: var(--primary); color: #000; }

        .sidebar {
            position: fixed; top: 0; left: -400px; width: 320px; height: 100%;
            background: rgba(15, 23, 42, 0.98); backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass); z-index: 1001;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 2rem; 
            box-shadow: 10px 0 30px rgba(0,0,0,0.8);
            display: flex; flex-direction: column; /* Flexbox for footer positioning */
        }
        .sidebar.active { left: 0; }
        
        .close-btn { position: absolute; top: 20px; right: 20px; background: none; border: none; color: var(--text-dim); font-size: 2rem; cursor: pointer; }
        
        /* Sidebar Styling */
        .sidebar-header h2 { color: var(--primary); margin: 3rem 0 1.5rem 0; border-bottom: 1px solid var(--glass); padding-bottom: 15px; font-weight: 400; }
        
        .sidebar-section { margin-bottom: 2rem; }
        .sidebar-label { font-size: 0.8rem; text-transform: uppercase; color: var(--text-dim); letter-spacing: 1px; margin-bottom: 10px; display: block; }
        
        .sidebar-btn {
            display: flex; align-items: center; gap: 15px;
            width: 100%; padding: 12px 15px;
            background: transparent; border: none; color: white;
            font-size: 1rem; cursor: pointer; border-radius: 8px;
            transition: 0.3s; text-align: left; font-family: 'Outfit', sans-serif;
        }
        .sidebar-btn:hover { background: rgba(56, 189, 248, 0.15); color: var(--primary); transform: translateX(5px); }
        .sidebar-btn span { font-size: 1.2rem; } /* Icon size */

        .sidebar-footer {
            margin-top: auto; /* Pushes to bottom */
            padding-top: 1rem; border-top: 1px solid var(--glass);
            text-align: center; color: var(--text-dim); font-size: 0.85rem;
        }
        .version-tag { background: rgba(255,255,255,0.1); padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; margin-top: 5px; display: inline-block; }

        /* --- NAVBAR --- */
        .navbar {
            width: 100%; padding: 1rem 0; background: transparent !important;
            backdrop-filter: none !important; border: none !important; box-shadow: none !important;
            display: flex; align-items: center; justify-content: center; position: relative; z-index: 100;
        }
        .brand-logo {
            height: 90px; width: auto; display: block;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.2)); 
            transition: transform 0.3s ease;
        }
        .brand-logo:hover { transform: scale(1.05); }

        /* --- HERO --- */
        .hero { text-align: center; padding: 1rem 1rem 2rem; }
        .hero h1 { font-size: 3.5rem; color: #ffffff; text-shadow: 0 4px 15px rgba(0,0,0,0.8); margin: 0; }
        .hero p { color: #e2e8f0; margin-top: 10px; font-size: 1.3rem; text-shadow: 0 2px 8px rgba(0,0,0,0.9); font-weight: 500; }

        /* --- MISSION SECTION --- */
        .mission-container { max-width: 1200px; margin: 0 auto 2rem auto; padding: 0 2rem; }
        .mission-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1.5rem; }
        .mission-card {
            position: relative; background: rgba(15, 23, 42, 0.85); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px; padding: 2rem 1.5rem; transition: all 0.4s; backdrop-filter: blur(20px);
            overflow: hidden; display: flex; flex-direction: column; align-items: flex-start;
        }
        .mission-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent); opacity: 0.5;
        }
        .mission-card:hover { transform: translateY(-10px); background: rgba(15, 23, 42, 0.95); box-shadow: 0 20px 40px rgba(0,0,0,0.6); }

        .card-bio { border-top: 4px solid #4ade80; } 
        .card-bio:hover .icon-box { color: #4ade80; background: rgba(74, 222, 128, 0.1); }
        .card-defense { border-top: 4px solid #38bdf8; } 
        .card-defense:hover .icon-box { color: #38bdf8; background: rgba(56, 189, 248, 0.1); }
        .card-heat { border-top: 4px solid #fb7185; } 
        .card-heat:hover .icon-box { color: #fb7185; background: rgba(251, 113, 133, 0.1); }
        .card-ai { border-top: 4px solid #c084fc; } 
        .card-ai:hover .icon-box { color: #c084fc; background: rgba(192, 132, 252, 0.1); }

        .icon-box {
            width: 50px; height: 50px; margin-bottom: 1.5rem; color: var(--text-dim); background: rgba(255, 255, 255, 0.05);
            border-radius: 12px; display: flex; align-items: center; justify-content: center; transition: 0.3s;
        }
        .icon-box svg { width: 28px; height: 28px; }
        .mission-card h3 { margin: 0 0 0.8rem 0; color: #fff; font-size: 1.3rem; font-weight: 700; }
        .mission-card p { color: #94a3b8; font-size: 0.95rem; line-height: 1.7; margin: 0; }

        /* --- VISION & INNOVATION --- */
        .vision-container {
            max-width: 1200px; margin: 0 auto 4rem auto; padding: 0 2rem;
            display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;
        }
        .vision-card {
            background: rgba(15, 23, 42, 0.7); border: 1px solid rgba(56, 189, 248, 0.2);
            border-radius: 20px; padding: 2.5rem; backdrop-filter: blur(15px);
        }
        .vision-card h2 {
            font-size: 1.8rem; color: #fff; margin-top: 0; margin-bottom: 1.5rem;
            display: flex; align-items: center; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px;
        }
        .vision-text { font-size: 1.05rem; line-height: 1.8; color: #cbd5e1; margin-bottom: 1.5rem; }
        .vision-highlight { color: var(--primary); font-weight: bold; }
        .tech-list { display: flex; flex-direction: column; gap: 1rem; }
        .tech-item {
            display: flex; align-items: flex-start; gap: 15px; background: rgba(255,255,255,0.05);
            padding: 1rem; border-radius: 12px; border-left: 3px solid var(--accent); transition: 0.3s;
        }
        .tech-item:hover { background: rgba(255,255,255,0.1); transform: translateX(5px); }
        .tech-icon { font-size: 1.5rem; background: rgba(0,0,0,0.3); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 8px; }
        .tech-content h4 { margin: 0 0 5px 0; color: white; font-size: 1.1rem; }
        .tech-content p { margin: 0; font-size: 0.9rem; color: #94a3b8; }
        @media (max-width: 900px) { .vision-container { grid-template-columns: 1fr; } }

        /* --- DASHBOARD --- */
        .dashboard { display: flex; flex-wrap: wrap; gap: 2rem; max-width: 1200px; margin: 0 auto; padding: 0 2rem 4rem; justify-content: center; }
        .glass-card {
            background: rgba(15, 23, 42, 0.75); backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.15); border-radius: 20px; padding: 2rem; flex: 1; min-width: 320px; max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        .control-panel h2, .result-panel h2 { margin-top: 0; color: var(--primary); font-weight: 400; display: flex; align-items: center; gap: 10px; margin-bottom: 20px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .icon { font-size: 1.5rem; }

        .input-group { margin-bottom: 1.5rem; }
        label { display: block; color: #cbd5e1; margin-bottom: 0.5rem; font-size: 0.9rem; letter-spacing: 0.5px; }
        input[type="text"] { width: 90%; background: rgba(0, 0, 0, 0.4); border: 1px solid var(--glass); color: white; padding: 12px; border-radius: 8px; font-size: 1rem; outline: none; transition: 0.3s; }
        input[type="text"]:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(56, 189, 248, 0.2); }

        .range-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .temp-badge { color: var(--primary); font-weight: bold; }
        input[type="range"] { width: 100%; height: 6px; background: #334155; border-radius: 5px; outline: none; -webkit-appearance: none; cursor: pointer; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: var(--primary); border-radius: 50%; cursor: pointer; box-shadow: 0 0 10px var(--primary); margin-top: -7px; }

        .drop-zone { border: 2px dashed rgba(255,255,255,0.3); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: 0.3s; background: rgba(0,0,0,0.3); position: relative; overflow: hidden; margin-bottom: 1.5rem; }
        .drop-zone:hover, .drop-zone.highlight { border-color: var(--primary); background: rgba(56, 189, 248, 0.15); }
        .drop-icon { font-size: 3rem; display: block; margin-bottom: 10px; }
        .file-name { display: block; margin-top: 10px; color: var(--accent); font-weight: bold; font-size: 0.9rem; text-shadow: 0 1px 2px black; }

        .btn-neon { width: 100%; background: linear-gradient(135deg, var(--primary), #0ea5e9); border: none; padding: 1rem; border-radius: 10px; color: #0f172a; font-weight: bold; font-size: 1.1rem; cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .btn-neon:hover { transform: translateY(-2px); box-shadow: 0 0 20px rgba(56, 189, 248, 0.6); }

        .result-panel { display: none; border-color: var(--primary); }
        .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .status-pill { padding: 5px 15px; border-radius: 50px; font-size: 0.8rem; font-weight: bold; background: #334155; }
        .status-pill.Healthy { background: var(--healthy); color: #064e3b; box-shadow: 0 0 10px var(--healthy); }
        .status-pill.Bleached { background: var(--bleached); color: #881337; box-shadow: 0 0 10px var(--bleached); }

        .image-preview-box { width: 100%; height: 250px; background: rgba(0,0,0,0.5); border-radius: 10px; overflow: hidden; position: relative; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; }
        .image-preview-box img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .stats-grid { display: flex; gap: 1rem; margin-bottom: 1.5rem; }
        .stat-item { flex: 1; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 10px; text-align: center; }
        .stat-item .label { display: block; font-size: 0.8rem; color: var(--text-dim); }
        .stat-item .value { font-size: 1.5rem; font-weight: bold; color: white; }

        .param-row { margin-bottom: 10px; }
        .progress-track { background: #334155; height: 8px; border-radius: 4px; overflow: hidden; margin-top: 5px; }
        .progress-fill { height: 100%; transition: width 1s; }
        .fill-green { background: var(--healthy); }
        .fill-red { background: var(--bleached); }

        /* LOADER */
        .loader-overlay { position: fixed; inset: 0; background: rgba(2, 6, 23, 0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 200; backdrop-filter: blur(5px); }
        .loader-circle { width: 50px; height: 50px; border: 4px solid #334155; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s infinite linear; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- CHATBOT --- */
        .chat-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: var(--accent); border: none; font-size: 1.5rem; cursor: pointer; box-shadow: 0 0 20px var(--accent); transition: 0.3s; z-index: 100; display: flex; align-items: center; justify-content: center; }
        .chat-btn:hover { transform: scale(1.1); }
        .chat-window { position: fixed; bottom: 100px; right: 30px; width: 320px; height: 400px; background: #1e293b; border-radius: 15px; border: 1px solid var(--glass); display: none; flex-direction: column; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 99; }
        .chat-header { background: #0f172a; padding: 15px; color: white; display: flex; justify-content: space-between; border-bottom: 1px solid var(--glass); align-items: center;}
        .chat-header button { background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 10px; font-size: 0.9rem; max-width: 80%; }
        .msg.bot { background: #334155; align-self: flex-start; }
        .msg.user { background: var(--primary); color: #0f172a; align-self: flex-end; }
        .chat-input-area { padding: 10px; background: #0f172a; display: flex; gap: 10px; }
        .chat-input-area input { flex: 1; background: #334155; border: none; padding: 10px; border-radius: 5px; color: white; outline: none; }
        .chat-input-area button { background: var(--accent); border: none; width: 40px; border-radius: 5px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div class="bg-image"></div>

    <div class="plankton-container"></div>

    <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>

    <div class="sidebar" id="sidebar">
        <button class="close-btn" onclick="toggleMenu()">√ó</button>
        <div class="sidebar-header">
            <h2>Command Center</h2>
        </div>

        <div class="sidebar-section">
            <span class="sidebar-label">Navigation</span>
            <button class="sidebar-btn" onclick="location.reload()">
                <span>üè†</span> Dashboard
            </button>
            <button class="sidebar-btn" onclick="alert('History Feature Pending Database Connection')">
                <span>üìú</span> Analysis History
            </button>
            <button class="sidebar-btn" onclick="alert('Gallery Feature Coming Soon!')">
                <span>üñºÔ∏è</span> Coral Gallery
            </button>
        </div>

        <div class="sidebar-section">
            <span class="sidebar-label">Tools</span>
            <button class="sidebar-btn" onclick="alert('Generating PDF Report...')">
                <span>üìÑ</span> Export Data
            </button>
            <button class="sidebar-btn" onclick="alert('Settings Panel Locked')">
                <span>‚öôÔ∏è</span> Settings
            </button>
            <button class="sidebar-btn" onclick="alert('Contact Support: admin@coralai.com')">
                <span>‚ùì</span> Help & Support
            </button>
        </div>

        <div class="sidebar-footer">
            <p>Developed by DeepBlue AI</p>
            <span class="version-tag">Coral Reef Inspector v2.1</span>
        </div>
    </div>

    <nav class="navbar">
        <div class="brand">
            <img src="/static/images/logo.png" alt="Coral Reef Inspector" class="brand-logo" onerror="this.style.display='none'; alert('Logo not found! Make sure file is named logo.png in static/images/');">
        </div>
    </nav>

    <div class="main-container">
        <header class="hero">
            <h1>Deep Ocean Analysis</h1>
            <p>AI-Powered Diagnostics for Reef Conservation</p>
        </header>

        <div class="mission-container">
            <div class="mission-grid">
                <div class="mission-card card-bio"><div class="icon-box"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6.5 12c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/><path d="M2 12c0 1.1.9 2 2 2h2c1.1 0 2-.9 2-2s-.9-2-2-2H4c-1.1 0-2 .9-2 2z"/><path d="M22 12c0-6-5-10-10-10-4 0-8 3-9 7"/><path d="M22 12c0 6-5 10-10 10-4 0-8-3-9-7"/><path d="M16 12h-2"/></svg></div><h3>Marine Biodiversity</h3><p>Reefs support 25% of all ocean life. We monitor these ecosystems to ensure stability.</p></div>
                <div class="mission-card card-defense"><div class="icon-box"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div><h3>Coastal Defense</h3><p>Healthy corals reduce wave energy by 97%, acting as a natural barrier against erosion.</p></div>
                <div class="mission-card card-heat"><div class="icon-box"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/></svg></div><h3>The Bleaching Crisis</h3><p>Early detection of thermal stress allows for rapid intervention and recovery planning.</p></div>
                <div class="mission-card card-ai"><div class="icon-box"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg></div><h3>Why This Project?</h3><p>We use <b>CNN Deep Learning</b> to automate analysis, making surveys 100x faster than divers.</p></div>
            </div>
        </div>

        <div class="vision-container">
            <div class="vision-card">
                <h2>üåé The Global Need</h2>
                <p class="vision-text">Coral reefs are dying at an alarming rate due to thermal stress and acidification. Traditional manual surveys by divers are too slow to keep up with the rate of bleaching.</p>
                <p class="vision-text">This project bridges the gap by providing <span class="vision-highlight">instant, AI-driven diagnostics</span> to marine biologists, enabling rapid response conservation.</p>
                <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                    <h3 style="color:white; margin-bottom:0.5rem;">üë®‚Äçüíª About</h3>
                    <p class="vision-text">Developed to save our oceans using the power of Deep Learning.</p>
                </div>
            </div>
            <div class="vision-card">
                <h2>üöÄ Future Innovations</h2>
                <div class="tech-list">
                    <div class="tech-item"><div class="tech-icon">üõ∏</div><div class="tech-content"><h4>Autonomous Underwater Vehicles (AUVs)</h4><p>Integrating this CNN model into drone cameras for live, automated reef mapping.</p></div></div>
                    <div class="tech-item"><div class="tech-icon">üõ∞Ô∏è</div><div class="tech-content"><h4>Satellite Integration</h4><p>Correlating local coral health with NASA sea surface temperature data.</p></div></div>
                    <div class="tech-item"><div class="tech-icon">‚ö°</div><div class="tech-content"><h4>Edge Computing</h4><p>Deploying the model on low-power devices for remote, solar-powered buoys.</p></div></div>
                </div>
            </div>
        </div>

        <div class="dashboard">
            <div class="glass-card control-panel">
                <h2><span class="icon">‚öôÔ∏è</span> Settings</h2>
                <form id="analysisForm">
                    <div class="input-group"><label>Observer ID</label><input type="text" id="name" name="name" placeholder="Enter Name" required></div>
                    <div class="input-group"><label>Reef Location</label><input type="text" id="country" name="country" placeholder="Region / Site" required></div>
                    <div class="input-group">
                        <div class="range-header"><label>Water Temp</label><span id="temp-display" class="temp-badge">25.0¬∞C</span></div>
                        <input type="range" id="temperature" name="temperature" min="18" max="32" step="0.5" value="25">
                    </div>
                    <div class="drop-zone" id="dropZone">
                        <div class="drop-content"><span class="drop-icon">‚òÅÔ∏è</span><p>Drag image here or <b>Click to Browse</b></p><span id="fileName" class="file-name">No file selected</span></div>
                        <input type="file" id="fileInput" name="file" accept="image/*" hidden>
                    </div>
                    <button type="submit" class="btn-neon"><span>‚ö° Run Analysis</span></button>
                </form>
            </div>
            <div class="glass-card result-panel" id="resultCard">
                <div class="result-header"><h2>Analysis Report</h2><span class="status-pill" id="statusPill">WAITING</span></div>
                <div class="image-preview-box"><img id="resultImage" src="" alt="Preview"></div>
                <div class="stats-grid">
                    <div class="stat-item"><span class="label">Confidence</span><span class="value" id="resultConfidence">--%</span></div>
                    <div class="stat-item"><span class="label">Condition</span><span class="value" id="resultCondition">--</span></div>
                </div>
                <div id="parameterContainer" class="bars-container"></div>
            </div>
        </div>
    </div>

    <div class="loader-overlay" id="loader"><div class="loader-circle"></div><p>Processing Neural Network...</p></div>

    <button class="chat-btn" onclick="toggleChat()">üí¨</button>
    <div class="chat-window" id="chatWindow">
        <div class="chat-header"><span>AI Assistant</span><button onclick="toggleChat()">‚úñ</button></div>
        <div class="chat-body" id="chatBody"><div class="msg bot">Hello! I'm ready to analyze. Upload an image!</div></div>
        <div class="chat-input-area"><input type="text" id="chatInput" placeholder="Ask about corals..."><button onclick="sendChat()">‚û§</button></div>
    </div>

    <script>
        function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); }

        document.addEventListener('DOMContentLoaded', () => {
            console.log("üåä Deep Ocean Interface Loaded");

            // Generate random plankton specks
            const container = document.querySelector('.plankton-container');
            for(let i=0; i<20; i++) {
                let div = document.createElement('div');
                div.className = 'speck';
                div.style.left = Math.random() * 100 + '%';
                div.style.top = Math.random() * 100 + '%';
                div.style.width = (Math.random() * 3 + 1) + 'px';
                div.style.height = div.style.width;
                div.style.animationDuration = (Math.random() * 10 + 10) + 's';
                div.style.animationDelay = (Math.random() * 5) + 's';
                container.appendChild(div);
            }

            const tempInput = document.getElementById('temperature');
            const tempDisplay = document.getElementById('temp-display');
            tempDisplay.textContent = parseFloat(tempInput.value).toFixed(1) + "¬∞C";
            tempInput.addEventListener('input', (e) => { tempDisplay.textContent = parseFloat(e.target.value).toFixed(1) + "¬∞C"; });

            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const fileName = document.getElementById('fileName');

            dropZone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', () => { if (fileInput.files.length > 0) updateFileUI(fileInput.files[0]); });
            dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('highlight'); });
            dropZone.addEventListener('dragleave', () => dropZone.classList.remove('highlight'));
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault(); dropZone.classList.remove('highlight');
                if (e.dataTransfer.files.length > 0) { fileInput.files = e.dataTransfer.files; updateFileUI(e.dataTransfer.files[0]); }
            });

            function updateFileUI(file) { fileName.textContent = "üìÇ " + file.name; fileName.style.color = "var(--primary)"; }

            const form = document.getElementById('analysisForm');
            const loader = document.getElementById('loader');
            const resultCard = document.getElementById('resultCard');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!fileInput.files[0]) { alert("‚ö†Ô∏è Please upload a coral image first!"); return; }
                loader.style.display = 'flex';
                try {
                    const formData = new FormData(form);
                    const response = await fetch('/analyze', { method: 'POST', body: formData });
                    const data = await response.json();
                    if (data.error) alert("Error: " + data.error);
                    else showResults(data);
                } catch (err) { console.error(err); alert("Server Error. Is python app.py running?"); } 
                finally { loader.style.display = 'none'; }
            });

            function showResults(data) {
                resultCard.style.display = 'block';
                document.getElementById('resultImage').src = data.image_url;
                document.getElementById('resultCondition').textContent = data.prediction;
                document.getElementById('resultConfidence').textContent = (data.confidence * 100).toFixed(1) + "%";
                const pill = document.getElementById('statusPill');
                pill.textContent = data.prediction.toUpperCase();
                pill.className = 'status-pill ' + data.prediction;
                
                const container = document.getElementById('parameterContainer');
                const isHealthy = data.prediction === 'Healthy';
                const stats = [
                    { name: "Algae Density", val: isHealthy ? rdm(75,98) : rdm(10,40) },
                    { name: "Tissue Integrity", val: isHealthy ? rdm(80,100) : rdm(20,50) },
                    { name: "Calcification", val: isHealthy ? rdm(60,90) : rdm(10,30) }
                ];
                let html = ``;
                stats.forEach(s => {
                    html += `<div class="param-row"><div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#94a3b8;"><span>${s.name}</span><span>${s.val}%</span></div><div class="progress-track"><div class="progress-fill ${s.val > 50 ? 'fill-green' : 'fill-red'}" style="width: ${s.val}%"></div></div></div>`;
                });
                container.innerHTML = html;
                resultCard.scrollIntoView({ behavior: 'smooth' });
            }

            function rdm(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

            window.toggleChat = () => { const win = document.getElementById('chatWindow'); win.style.display = (win.style.display === 'flex') ? 'none' : 'flex'; };
            window.sendChat = () => {
                const input = document.getElementById('chatInput'); const text = input.value.trim(); if(!text) return;
                addMsg(text, 'user'); input.value = '';
                setTimeout(() => {
                    let reply = "I analyze coral health based on color and texture.";
                    if(text.toLowerCase().includes('temp')) reply = "Corals prefer 23-29¬∞C. Higher temps cause bleaching.";
                    else if(text.toLowerCase().includes('bleach')) reply = "Bleaching is a stress response where algae leaves the coral.";
                    else if(text.toLowerCase().includes('aura')) reply = "Rehansanjay radiates aura ‚ú®";
                    else if(text.toLowerCase().includes('vijay')) reply = "Vj <- Sp <- Sk (The Hierarchy).";
                    addMsg(reply, 'bot');
                }, 600);
            };
            function addMsg(text, type) {
                const body = document.getElementById('chatBody'); const div = document.createElement('div');
                div.className = `msg ${type}`; div.textContent = text; body.appendChild(div); body.scrollTop = body.scrollHeight;
            }
        });
    </script>
</body>
</html>